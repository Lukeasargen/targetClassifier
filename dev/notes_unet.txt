


pooling: use maxpool
f=16 avgpool leaky=0.2 ts=256 bs=16 lr=0.1,[14,20],24,0.1 m=0.9 wd=0.0 bce
loss=0.03721. acc=0.96077. bce=0.03721. jaccard=0.82711. dice=0.90531. tversky=0.90208. focal=0.00003.
f=16 maxpool leaky=0.2 ts=256 bs=16 lr=0.1,[14,20],24,0.1 m=0.9 wd=0.0 bce
loss=0.03641. acc=0.96067. bce=0.03641. jaccard=0.83636. dice=0.91078. tversky=0.90987. focal=0.00003.
f=16 stride=2 leaky=0.2 ts=256 bs=16 lr=0.1,[14,20],24,0.1 m=0.9 wd=0.0 bce
loss=0.04516. acc=0.95748. bce=0.04516. jaccard=0.80625. dice=0.89251. tversky=0.89374. focal=0.00005.

weight decay: add it
f=16 stride=2 leaky=0.2 ts=256 bs=16 lr=0.1,[14,20],24,0.1 m=0.9 wd=5e-4 bce
loss=0.04175. acc=0.95965. bce=0.04175. jaccard=0.81426. dice=0.89758. tversky=0.89551. focal=0.00004.
f=16 maxpool leaky=0.2 ts=256 bs=16 lr=0.1,[14,20],24,0.1 m=0.9 wd=5e-4 bce
loss=0.03791. acc=0.95966. bce=0.03791. jaccard=0.82527. dice=0.90422. tversky=0.90364. focal=0.00003.
f=16 avgpool leaky=0.2 ts=256 bs=16 lr=0.1,[14,20],24,0.1 m=0.9 wd=5e-4 bce
loss=0.04082. acc=0.95895. bce=0.04082. jaccard=0.81916. dice=0.90049. tversky=0.89951. focal=0.00003.

activation: regular relu is better
f=16 maxpool relu ts=256 bs=16 lr=0.1,[14,20],24,0.1 m=0.9 wd=5e-4 bce
loss=0.03504. acc=0.96223. bce=0.03504. jaccard=0.83678. dice=0.91109. tversky=0.90911. focal=0.00002.

which loss: jaccard has best metrics
f=16 maxpool relu ts=256 bs=16 lr=0.1,[14,20],24,0.1 m=0.9 wd=5e-4 jaccard
loss=0.09772. acc=0.96380. bce=0.07322. jaccard=0.90228. dice=0.94858. tversky=0.95572. focal=0.00019.
f=16 maxpool relu ts=256 bs=16 lr=0.1,[14,20],24,0.1 m=0.9 wd=5e-4 dice
loss=0.05941. acc=0.96024. bce=0.07636. jaccard=0.88790. dice=0.94059. tversky=0.94908. focal=0.00023.
f=16 maxpool relu ts=256 bs=16 lr=0.1,[14,20],24,0.1 m=0.9 wd=5e-4 tversky(a=0.8,b=0.2)
loss=0.00054. acc=0.45020. bce=1.55466. jaccard=0.00034. dice=0.00069. tversky=0.00054. focal=0.48396.  always outputs no target
f=16 maxpool relu ts=256 bs=16 lr=0.1,[14,20],24,0.1 m=0.9 wd=5e-4 tversky(a=0.3,b=0.7)
loss=0.04820. acc=0.96188. bce=0.05800. jaccard=0.89408. dice=0.94404. tversky=0.95180. focal=0.00010.  a lot less fn with b>0.5
f=16 maxpool relu ts=256 bs=16 lr=0.1,[14,20],24,0.1 m=0.9 wd=5e-4 focal(a=0.5,g=2)
loss=0.00122. acc=0.93189. bce=0.14086. jaccard=0.43189. dice=0.60315. tversky=0.57819. focal=0.00122.  really bad, gets like 3 targets

loss w bce
f=16 maxpool relu ts=256 bs=16 lr=0.1,[14,20],24,0.1 m=0.9 wd=5e-4 bce,jaccard
loss=0.16853. acc=0.95936. bce=0.04523. jaccard=0.87670. dice=0.93426. tversky=0.93853. focal=0.00005.
f=16 maxpool relu ts=256 bs=16 lr=0.1,[14,20],24,0.1 m=0.9 wd=5e-4 bce,dice
loss=0.09659. acc=0.96324. bce=0.03627. jaccard=0.88634. dice=0.93968. tversky=0.94226. focal=0.00003.
f=16 maxpool relu ts=256 bs=16 lr=0.1,[14,20],24,0.1 m=0.9 wd=5e-4 bce,tversky(a=0.8,b=0.2)
loss=0.10795. acc=0.95802. bce=0.05153. jaccard=0.85508. dice=0.92179. tversky=0.94357. focal=0.00007.
f=16 maxpool relu ts=256 bs=16 lr=0.1,[14,20],24,0.1 m=0.9 wd=5e-4 bce,tversky(a=0.3,b=0.7)
loss=0.10010. acc=0.96004. bce=0.03877. jaccard=0.87769. dice=0.93483. tversky=0.93867. focal=0.00003.
f=16 maxpool relu ts=256 bs=16 lr=0.1,[14,20],24,0.1 m=0.9 wd=5e-4 bce,focal(a=0.5,g=2)
loss=0.03409. acc=0.96187. bce=0.03407. jaccard=0.84334. dice=0.91495. tversky=0.91354. focal=0.00002.  seemed to have less fn

loss w jaccard
f=16 maxpool relu ts=256 bs=16 lr=0.1,[14,20],24,0.1 m=0.9 wd=5e-4 jaccard,dice
loss=0.16821. acc=0.96159. bce=0.09619. jaccard=0.89002. dice=0.94177. tversky=0.92057. focal=0.00044.  had some more fp
f=16 maxpool relu ts=256 bs=16 lr=0.1,[14,20],24,0.1 m=0.9 wd=5e-4 jaccard,tversky(a=0.3,b=0.7)
loss=0.16268. acc=0.96110. bce=0.10575. jaccard=0.89472. dice=0.94438. tversky=0.94260. focal=0.00058.
f=16 maxpool relu ts=256 bs=16 lr=0.1,[14,20],24,0.1 m=0.9 wd=5e-4 jaccard,tversky(a=0.3,b=0.7)
loss=0.15258. acc=0.96210. bce=0.08420. jaccard=0.90025. dice=0.94747. tversky=0.94717. focal=0.00028.
f=16 maxpool relu ts=256 bs=16 lr=0.1,[14,20],24,0.1 m=0.9 wd=5e-4 jaccard,tversky(a=0.2,b=0.8)
loss=0.15286. acc=0.96091. bce=0.09035. jaccard=0.89953. dice=0.94706. tversky=0.94761. focal=0.00036.
f=16 maxpool relu ts=256 bs=16 lr=0.1,[14,20],24,0.1 m=0.9 wd=5e-4 jaccard,tversky(a=0.1,b=0.9)
loss=0.15949. acc=0.95972. bce=0.10471. jaccard=0.89066. dice=0.94214. tversky=0.94984. focal=0.00056.
f=16 maxpool relu ts=256 bs=16 lr=0.1,[14,20],24,0.1 m=0.9 wd=5e-4 jaccard,tversky(a=0.0,b=1.0)
loss=0.17008. acc=0.95784. bce=0.13885. jaccard=0.87864. dice=0.93538. tversky=0.95128. focal=0.00120.
f=16 maxpool relu ts=256 bs=16 lr=0.1,[14,20],24,0.1 m=0.9 wd=5e-4 jaccard,focal(a=0.5,g=2)
loss=0.11394. acc=0.95927. bce=0.08753. jaccard=0.88639. dice=0.93973. tversky=0.93294. focal=0.00033.  bad fn


optimizer: AdamW with Milestone Scheduler
SGD seems to work everytime with the right lr schedule
RMSProp needs lower learning rate, 1e-3 is a good start, higher dice than SGD
Adam, 4e-3 does work, higher dice than RMSProp, better than RMSProp near the end of training, might do better with small gradients than RMSProp
AdamW, 4e-3, wd=5e-4 better dice than Adam

scheduler:
ReduceLROnPlateau patience=10 SGD lr=1e-1 wd=5e-4 m=0.9
steps at 75, 94, 105, 116, dice of 0.972 is very high



run00556_final - same training as old unet
loss=0.02474. acc=0.96562. bce=0.03923. jaccard=0.95174. dice=0.97525. tversky=0.97347. focal=0.00003.

run00596_final - convergence, dice loss, google
loss=0.02526. acc=0.96340. bce=0.04161. jaccard=0.95074. dice=0.97474. tversky=0.97347. focal=0.00004.
run00597_final - convergence, bce and dice loss, dota
loss=0.05909. acc=0.96345. bce=0.02326. jaccard=0.93093. dice=0.96417. tversky=0.96294. focal=0.00001.
run00598_final - convergence, dice loss, dota
loss=0.03214. acc=0.96855. bce=0.04825. jaccard=0.93783. dice=0.96786. tversky=0.96520. focal=0.00008.
run00599_final - convergence, dice loss, dota google
loss=0.02761. acc=0.96850. bce=0.03990. jaccard=0.94631. dice=0.97239. tversky=0.97054. focal=0.00004.
run00600_final - convergence, dice loss, dota google, filters=32
loss=0.02574. acc=0.96897. bce=0.04028. jaccard=0.94985. dice=0.97426. tversky=0.97040. focal=0.00004.



filters
605 f=2 maxpool relu ts=256 bs=8 plateau 300 lr=0.1,p=80,g=0.2 m=0.9 wd=5e-4 dice
Total params: 30,751 Params size (MB): 0.12
loss=0.07610. acc=0.95982. bce=0.09423. jaccard=0.85926. dice=0.92390. tversky=0.92183. focal=0.00063.

607 f=4 maxpool relu ts=256 bs=8 plateau 300 lr=0.1,p=50,g=0.2 m=0.9 wd=5e-4 dice
Total params: 122,093 Params size (MB): 0.47
loss=0.05514. acc=0.96581. bce=0.08372. jaccard=0.89583. dice=0.94486. tversky=0.94213. focal=0.00033.

608 f=8 maxpool relu ts=256 bs=8 plateau 300 lr=0.1,p=50,g=0.2 m=0.9 wd=5e-4 dice
Total params: 486,553 Params size (MB): 1.86
loss=0.03380. acc=0.96777. bce=0.04980. jaccard=0.93476. dice=0.96620. tversky=0.96057. focal=0.00013.

609 f=16 maxpool relu ts=256 bs=8 plateau 300 lr=0.1,p=50,g=0.2 m=0.9 wd=5e-4 dice
Total params: 1,942,577 Params size (MB): 7.41
loss=0.03020. acc=0.96886. bce=0.04543. jaccard=0.94144. dice=0.96980. tversky=0.96523. focal=0.00005.

610 f=32 maxpool relu ts=256 bs=8 plateau 300 lr=0.1,p=50,g=0.2 m=0.9 wd=5e-4 dice
Total params: 7,763,041 Params size (MB): 29.61
loss=0.02704. acc=0.96466. bce=0.04487. jaccard=0.94741. dice=0.97296. tversky=0.96951. focal=0.00005.

612 f=64 maxpool relu ts=256 bs=8 step 180 lr=0.1,[120, 160],0.2 m=0.9 wd=5e-4 dice
Total params: 31,037,633 Params size (MB): 118.40
loss=0.02431. acc=0.96897. bce=0.03472. jaccard=0.95257. dice=0.97569. tversky=0.97262. focal=0.00002.


613 f=16 maxpool relu ts=256 bs=8 adamw plateau 400 lr=4e-3,p=60,g=0.2 m=0.9 wd=5e-4 dice,focal
loss=0.02766. acc=0.96640. bce=0.09295. jaccard=0.94771. dice=0.97313. tversky=0.96900. focal=0.00079.

614 f=16 maxpool relu ts=256 bs=8 adam plateau 400 lr=4e-3,p=60,g=0.2 m=0.9 wd=5e-4 dice,focal
loss=0.02927. acc=0.96588. bce=0.09636. jaccard=0.94497. dice=0.97166. tversky=0.96698. focal=0.00093.

615 f=16 maxpool relu ts=256 bs=8 sgd plateau 400 lr=1e-2,p=60,g=0.2 m=0.9 wd=5e-4 jaccard
loss=0.06874. acc=0.96394. bce=0.05970. jaccard=0.93126. dice=0.96437. tversky=0.95847. focal=0.00011.

# try stride again, not good
621 f=16 stride=2 relu bn ts=256 bs=8 sgd plateau 400 lr=1e-2,p=50,g=0.2 m=0.9 wd=5e-4 dice
loss=0.03424. acc=0.96556. bce=0.05634. jaccard=0.93396. dice=0.96576. tversky=0.96035. focal=0.00012.
622 f=16 stride=2 leaky=0.2 bn ts=256 bs=8 sgd plateau 400 lr=1e-2,p=50,g=0.2 m=0.9 wd=5e-4 dice
loss=0.03022. acc=0.96949. bce=0.04681. jaccard=0.94140. dice=0.96978. tversky=0.96529. focal=0.00006.


# Activations, relu and mish did best
617 f=16 maxpool relu bn ts=256 bs=8 sgd plateau 400 lr=1e-2,p=50,g=0.2 m=0.9 wd=5e-4 dice
loss=0.02622. acc=0.96856. bce=0.04235. jaccard=0.94893. dice=0.97378. tversky=0.97054. focal=0.00004.
618 f=16 maxpool leaky=0.2 bn ts=256 bs=8 sgd plateau 400 lr=1e-2,p=50,g=0.2 m=0.9 wd=5e-4 dice
loss=0.04031. acc=0.96316. bce=0.05693. jaccard=0.92278. dice=0.95969. tversky=0.95566. focal=0.00012.
619 f=16 maxpool wo/act bn ts=256 bs=8 sgd plateau 400 lr=1e-2,p=50,g=0.2 m=0.9 wd=5e-4 dice
loss=0.08059. acc=0.95679. bce=0.14606. jaccard=0.85116. dice=0.91941. tversky=0.90907. focal=0.00144.
629 f=16 maxpool silu bn ts=256 bs=8 sgd plateau 400 lr=1e-2,p=50,g=0.2 m=0.9 wd=5e-4 dice
loss=0.07031. acc=0.96191. bce=0.11538. jaccard=0.86914. dice=0.92969. tversky=0.92182. focal=0.00076.
630 f=16 maxpool mish bn ts=256 bs=8 sgd plateau 400 lr=1e-2,p=50,g=0.2 m=0.9 wd=5e-4 dice
loss=0.02850. acc=0.96828. bce=0.04215. jaccard=0.94461. dice=0.97150. tversky=0.96729. focal=0.00004.



# All models after 631 use the new encoder decode structure


634 unet_nested f=16 maxpool relu bn ts=256 bs=8 sgd plateau 100 lr=1e-2,p=50,g=0.2 m=0.9 wd=5e-4 dice
Duration=9.73 minutes. loss=0.04949. acc=0.96355. bce=0.06985. jaccard=0.90708. dice=0.95051. tversky=0.93938. focal=0.00073.
635 unet f=16 maxpool relu bn ts=256 bs=8 sgd plateau 100 lr=1e-2,p=50,g=0.2 m=0.9 wd=5e-4 dice
Duration=4.72 minutes. loss=0.06385. acc=0.96186. bce=0.10081. jaccard=0.88162. dice=0.93615. tversky=0.92592. focal=0.00108.


638 in=256 unet_nested f=16 maxpool relu bn ts=256 bs=8 sgd plateau 100 lr=1e-2,p=50,g=0.2 m=0.9 wd=5e-4 dice
Duration=36.05 minutes. loss=0.02477. acc=0.96771. bce=0.03840. jaccard=0.95168. dice=0.97523. tversky=0.97250. focal=0.00003.


# Models after 668 use deep supervision


# model speed
unet f16 relu in=256
For model.train() : Latency=4.26 ms. FPS=234.7397
For model.eval() : Latency=2.70 ms. FPS=371.0574
For predict() : Latency=2.56 ms. FPS=390.6249

unet f16 leaky_relu in=256
For model.train() : Latency=4.31 ms. FPS=231.9075
For model.eval() : Latency=2.73 ms. FPS=366.3003
For predict() : Latency=2.52 ms. FPS=397.4167

unet f16 silu in=256
For model.train() : Latency=4.06 ms. FPS=246.4305
For model.eval() : Latency=2.44 ms. FPS=409.8362
For predict() : Latency=2.29 ms. FPS=436.1993

unet f16 mish in=256
For model.train() : Latency=4.95 ms. FPS=201.9182
For model.eval() : Latency=3.32 ms. FPS=300.8651
For predict() : Latency=2.91 ms. FPS=343.2004

unet_nested f16 relu in=256
For model.train() : Latency=10.33 ms. FPS=96.7849
For model.eval() : Latency=6.37 ms. FPS=157.0114
For predict() : Latency=6.31 ms. FPS=158.3540

unet_nested f16 leaky_relu in=256
For model.train() : Latency=10.30 ms. FPS=97.1109
For model.eval() : Latency=6.36 ms. FPS=157.2636
For predict() : Latency=6.27 ms. FPS=159.6167

unet_nested f16 silu in=256
For model.train() : Latency=10.08 ms. FPS=99.2311
For model.eval() : Latency=6.19 ms. FPS=161.5089
For predict() : Latency=6.08 ms. FPS=164.4035

unet_nested f16 mish in=256
For model.train() : Latency=11.21 ms. FPS=89.1696
For model.eval() : Latency=7.28 ms. FPS=137.4119
For predict() : Latency=7.17 ms. FPS=139.5294




# Test with 8 filters
 in=256 unet f=8 maxpool relu bn ts=256 bs=8 sgd plateau 200 lr=1e-2,p=50,g=0.2 m=0.9 wd=5e-4 dice

 in=256 unet_nested f=8 maxpool relu bn ts=256 bs=8 sgd plateau 100 lr=1e-2,p=50,g=0.2 m=0.9 wd=5e-4 dice




# Batch size




# fill probability



